#!/bin/bash

export PROJECTNAME="."


echo "the project location is : $PROJECTNAME"
echo "removing libs"
vdel -lib $PROJECTNAME/LIB/LIB_RTL -all
vdel -lib $PROJECTNAME/LIB/LIB_BENCH -all

echo "creating library "

vlib $PROJECTNAME/LIB/LIB_RTL
vmap LIB_RTL $PROJECTNAME/LIB/LIB_RTL
vlib $PROJECTNAME/LIB/LIB_BENCH
vmap LIB_BENCH $PROJECTNAME/LIB/LIB_BENCH

# compilation des fichiers sources
echo "compile vhdl sources"
vlog -sv +acc -svinputport=net -work LIB_RTL $PROJECTNAME/SRC/RTL/half_sub.sv 
vlog -sv +acc -svinputport=net -work LIB_RTL $PROJECTNAME/SRC/RTL/subtractor.sv 
vlog -sv +acc -svinputport=net -work LIB_RTL $PROJECTNAME/SRC/RTL/subtractor_n.sv 
vlog -sv +acc -svinputport=net -work LIB_RTL $PROJECTNAME/SRC/RTL/mod_add.sv 
vlog -sv +acc -svinputport=net -work LIB_RTL $PROJECTNAME/SRC/RTL/mod_sub.sv 


# Compilation des fichiers TB
echo "compile vhdl test bench"
vlog -L LIB_RTL -sv +acc -svinputport=net -work LIB_BENCH $PROJECTNAME/SRC/BENCH/half_sub_tb.sv
vlog -L LIB_RTL -sv +acc -svinputport=net -work LIB_BENCH $PROJECTNAME/SRC/BENCH/subtractor_tb.sv
vlog -L LIB_RTL -sv +acc -svinputport=net -work LIB_BENCH $PROJECTNAME/SRC/BENCH/subtractor_n_tb.sv
vlog -L LIB_RTL -sv +acc -svinputport=net -work LIB_BENCH $PROJECTNAME/SRC/BENCH/mod_add_tb.sv
vlog -L LIB_RTL -sv +acc -svinputport=net -work LIB_BENCH $PROJECTNAME/SRC/BENCH/mod_sub_tb.sv

# lancement du simulateur
echo "compilation finished"
echo "start simulation..."

# ATTENTION un seul VSIM decommenté à la fois!
#vsim -L LIB_RTL LIB_BENCH.half_sub_tb
#vsim -L LIB_RTL LIB_BENCH.subtractor_tb
#vsim -L LIB_RTL LIB_BENCH.subtractor_n_tb
#vsim -L LIB_RTL LIB_BENCH.mod_add_tb
vsim -L LIB_RTL LIB_BENCH.mod_sub_tb



